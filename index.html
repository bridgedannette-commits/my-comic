<!DOCTYPE html> <html lang="ru"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>Комикс</title> <link rel="stylesheet" href="css/styles.css"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet"> </head> <body> <div class="comic-reader" id="reader"> <div class="canvas-wrapper" id="canvasWrapper"> <div class="comic-canvas" id="comicCanvas"></div> </div> <div class="zoom-indicator" id="zoomIndicator"> <span id="zoomPercent">100%</span> </div> <div class="controls-wrapper"> <div class="controls"> <button id="toTop" title="В начало">▲</button> <button id="zoomOut" title="Уменьшить">−</button> <span id="pageInfo">– / –</span> <button id="zoomIn" title="Увеличить">+</button> <button id="toBottom" title="В конец">▼</button> </div> </div> <div class="progress"> <div class="progress-bar" id="progressBar"></div> </div> </div> <script> /* ====================================================== НАСТРОЙКИ ====================================================== */ const COMIC_PATH = 'https://bridgedannette-commits.github.io/my-comic/comics/test/'; const IMAGE_EXTS = ['webp', 'png', 'jpg', 'jpeg']; const MIN_ZOOM = 0.5; const MAX_ZOOM = 3.0; const ZOOM_STEP = 0.2; const MAX_PAGES_SAFE = 500; // защита от бесконечного цикла /* ====================================================== СОСТОЯНИЕ ====================================================== */ let zoom = 1; let pages = []; const wrapper = document.getElementById('canvasWrapper'); const canvas = document.getElementById('comicCanvas'); const pageInfo = document.getElementById('pageInfo'); const progressBar = document.getElementById('progressBar'); const zoomIndicator = document.getElementById('zoomIndicator'); const zoomPercent = document.getElementById('zoomPercent'); /* ====================================================== ВСПОМОГАТЕЛЬНЫЕ ====================================================== */ async function imageExists(url) { try { const res = await fetch(url, { method: 'HEAD', cache: 'no-store' }); return res.ok; } catch { return false; } } /* ====================================================== АВТОПОИСК СТРАНИЦ ====================================================== */ async function detectPages() { const result = []; let pageNum = 1; while (pageNum <= MAX_PAGES_SAFE) { let found = false; for (const ext of IMAGE_EXTS) { const url = ${COMIC_PATH}${pageNum}.${ext}; if (await imageExists(url)) { result.push(url); found = true; break; } } if (!found) break; pageNum++; } return result; } /* ====================================================== ЗАГРУЗКА КОМИКСА ====================================================== */ async function loadComic() { canvas.innerHTML = 'Загрузка…'; pages = await detectPages(); canvas.innerHTML = ''; pages.forEach(src => { const page = document.createElement('div'); page.className = 'comic-page'; const img = document.createElement('img'); img.src = src; img.loading = 'lazy'; img.draggable = false; page.appendChild(img); canvas.appendChild(page); }); updatePageInfo(); } /* ====================================================== ZOOM ====================================================== */ function applyZoom(delta) { const next = zoom + delta; if (next < MIN_ZOOM || next > MAX_ZOOM) return; zoom = +next.toFixed(2); canvas.style.transform = scale(${zoom}); zoomPercent.textContent = ${Math.round(zoom * 100)}%; zoomIndicator.classList.add('visible'); clearTimeout(zoomIndicator._t); zoomIndicator._t = setTimeout(() => { zoomIndicator.classList.remove('visible'); }, 1500); } /* ====================================================== СТРАНИЦЫ ====================================================== */ function getCurrentPage() { const items = canvas.querySelectorAll('.comic-page'); if (!items.length) return 1; const wrapperRect = wrapper.getBoundingClientRect(); const center = wrapperRect.top + wrapperRect.height / 2; let closest = 1; let minDistance = Infinity; items.forEach((el, i) => { const r = el.getBoundingClientRect(); const c = r.top + r.height / 2; const d = Math.abs(c - center); if (d < minDistance) { minDistance = d; closest = i + 1; } }); return closest; } function updatePageInfo() { pageInfo.textContent = ${getCurrentPage()} / ${pages.length}; } /* ====================================================== SCROLL ====================================================== */ wrapper.addEventListener('scroll', () => { const max = wrapper.scrollHeight - wrapper.clientHeight; if (max > 0) { progressBar.style.width = ${(wrapper.scrollTop / max) * 100}%; } updatePageInfo(); }, { passive: true }); /* ====================================================== КНОПКИ ====================================================== */ document.getElementById('zoomIn').onclick = () => applyZoom(ZOOM_STEP); document.getElementById('zoomOut').onclick = () => applyZoom(-ZOOM_STEP); document.getElementById('toTop').onclick = () => { wrapper.scrollTo({ top: 0, behavior: 'smooth' }); }; document.getElementById('toBottom').onclick = () => { wrapper.scrollTo({ top: wrapper.scrollHeight, behavior: 'smooth' }); }; /* ====================================================== INIT ====================================================== */ document.addEventListener('DOMContentLoaded', loadComic); </script> </body> </html>
