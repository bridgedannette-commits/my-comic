<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Комикс</title>

<link rel="stylesheet" href="css/styles.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>

<div class="comic-reader" id="reader">
  <div class="canvas-wrapper" id="canvasWrapper">
    <div class="comic-canvas" id="comicCanvas"></div>
  </div>

  <div class="zoom-indicator" id="zoomIndicator">
    <span id="zoomPercent">100%</span>
  </div>

  <div class="controls-wrapper">
    <div class="controls">
      <button id="toTop">▲</button>
      <button id="zoomOut">−</button>
      <span id="pageInfo">– / –</span>
      <button id="zoomIn">+</button>
      <button id="toBottom">▼</button>
    </div>
  </div>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>
</div>

<script>
/* ================= НАСТРОЙКИ ================= */

const IMAGES_PATH = 'https://bridgedannette-commits.github.io/my-comic/comics/test/';
const IMAGE_COUNT = 10; // ← количество страниц

const MIN_ZOOM = 0.5;
const MAX_ZOOM = 3.0;
const ZOOM_STEP = 0.2;

/* ================= СОСТОЯНИЕ ================= */

let zoom = 1;

const wrapper = document.getElementById('canvasWrapper');
const canvas = document.getElementById('comicCanvas');
const pageInfo = document.getElementById('pageInfo');
const progressBar = document.getElementById('progressBar');
const zoomIndicator = document.getElementById('zoomIndicator');
const zoomPercent = document.getElementById('zoomPercent');

/* ================= ЗАГРУЗКА КОМИКСА ================= */

function loadComic() {
  canvas.innerHTML = '';

  for (let i = 1; i <= IMAGE_COUNT; i++) {
    const page = document.createElement('div');
    page.className = 'comic-page';

    const img = document.createElement('img');
    img.src = `${IMAGES_PATH}${i}.png`;
    img.loading = 'lazy';
    img.draggable = false;

    page.appendChild(img);
    canvas.appendChild(page);
  }

  updatePageInfo();
}

loadComic();

/* ================= ZOOM ================= */

function applyZoom(delta) {
  const next = zoom + delta;
  if (next < MIN_ZOOM || next > MAX_ZOOM) return;

  zoom = +next.toFixed(2);
  canvas.style.transform = `scale(${zoom})`;

  zoomPercent.textContent = `${Math.round(zoom * 100)}%`;
  zoomIndicator.classList.add('visible');

  clearTimeout(zoomIndicator._t);
  zoomIndicator._t = setTimeout(() => {
    zoomIndicator.classList.remove('visible');
  }, 1500);
}

/* ================= ТЕКУЩАЯ СТРАНИЦА ================= */

function getCurrentPage() {
  const pages = canvas.querySelectorAll('.comic-page');
  if (!pages.length) return 1;

  const wrapperRect = wrapper.getBoundingClientRect();
  const center = wrapperRect.top + wrapperRect.height / 2;

  let closest = 1;
  let minDistance = Infinity;

  pages.forEach((page, i) => {
    const rect = page.getBoundingClientRect();
    const pageCenter = rect.top + rect.height / 2;
    const distance = Math.abs(pageCenter - center);

    if (distance < minDistance) {
      minDistance = distance;
      closest = i + 1;
    }
  });

  return closest;
}

function updatePageInfo() {
  pageInfo.textContent = `${getCurrentPage()} / ${IMAGE_COUNT}`;
}

/* ================= SCROLL ================= */

wrapper.addEventListener('scroll', () => {
  const maxScroll = wrapper.scrollHeight - wrapper.clientHeight;
  if (maxScroll > 0) {
    progressBar.style.width = `${(wrapper.scrollTop / maxScroll) * 100}%`;
  }
  updatePageInfo();
}, { passive: true });

/* ================= КНОПКИ ================= */

document.getElementById('zoomIn').onclick = () => applyZoom(ZOOM_STEP);
document.getElementById('zoomOut').onclick = () => applyZoom(-ZOOM_STEP);

document.getElementById('toTop').onclick = () => {
  wrapper.scrollTo({ top: 0, behavior: 'smooth' });
};

document.getElementById('toBottom').onclick = () => {
  wrapper.scrollTo({ top: wrapper.scrollHeight, behavior: 'smooth' });
};

/* ================= RESIZE ================= */

window.addEventListener('resize', () => {
  updatePageInfo();
});
</script>

</body>
</html>
